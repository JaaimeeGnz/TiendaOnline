---
/**
 * src/pages/admin/index.astro
 * Dashboard del admin (SSR protegido)
 */

import AdminLayout from '../../layouts/AdminLayout.astro';
import { supabaseClient } from '../../lib/supabase';

// Obtener estadísticas
const { data: products } = await supabaseClient.from('products').select('*');
const { data: categories } = await supabaseClient.from('categories').select('*');

const totalProducts = products?.length || 0;
const totalCategories = categories?.length || 0;
const lowStockCount = products?.filter((p) => p.stock > 0 && p.stock <= 5).length || 0;
const outOfStockCount = products?.filter((p) => p.stock === 0).length || 0;
---

<AdminLayout title="Dashboard">
  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-primary-800">Dashboard</h1>
    <p class="text-neutral-gray_dark mt-1">Bienvenido al panel de administración</p>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Products -->
    <div class="bg-white border border-primary-200 rounded-lg p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-neutral-gray_dark">Total de Productos</p>
          <p class="text-3xl font-bold text-primary-800 mt-2">{totalProducts}</p>
        </div>
        <div class="w-12 h-12 bg-primary-50 rounded-lg flex items-center justify-center">
          <svg
            class="w-6 h-6 text-primary-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M20 7l-8-4-8 4m0 0l8 4m-8-4v10l8 4m0-10l8 4m-8-4v10"
            />
          </svg>
        </div>
      </div>
    </div>

    <!-- Categories -->
    <div class="bg-white border border-primary-200 rounded-lg p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-neutral-gray_dark">Categorías</p>
          <p class="text-3xl font-bold text-primary-800 mt-2">{totalCategories}</p>
        </div>
        <div class="w-12 h-12 bg-primary-50 rounded-lg flex items-center justify-center">
          <svg
            class="w-6 h-6 text-primary-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
            />
          </svg>
        </div>
      </div>
    </div>

    <!-- Low Stock -->
    <div class="bg-white border border-amber-200 rounded-lg p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-neutral-gray_dark">Stock Bajo</p>
          <p class="text-3xl font-bold text-amber-600 mt-2">{lowStockCount}</p>
        </div>
        <div class="w-12 h-12 bg-amber-50 rounded-lg flex items-center justify-center">
          <svg
            class="w-6 h-6 text-amber-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 9v2m0 4v2m0 0v2m0-6V9m0 0V7m0 6v2m0 0v2"
            />
          </svg>
        </div>
      </div>
    </div>

    <!-- Out of Stock -->
    <div class="bg-white border border-red-200 rounded-lg p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm text-neutral-gray_dark">Agotados</p>
          <p class="text-3xl font-bold text-red-600 mt-2">{outOfStockCount}</p>
        </div>
        <div class="w-12 h-12 bg-red-50 rounded-lg flex items-center justify-center">
          <svg
            class="w-6 h-6 text-red-600"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white border border-primary-200 rounded-lg p-6">
      <h2 class="text-lg font-bold text-primary-800 mb-4">Acciones Rápidas</h2>
      <div class="space-y-2">
        <a
          href="/admin/productos"
          class="block px-4 py-2 bg-primary-50 text-primary-800 rounded hover:bg-primary-100 transition text-sm font-semibold"
        >
          Gestionar Productos
        </a>
        <a
          href="/admin/productos/nuevo"
          class="block px-4 py-2 bg-green-50 text-green-700 rounded hover:bg-green-100 transition text-sm font-semibold"
        >
          + Nuevo Producto
        </a>
        <a
          href="/admin/categorias"
          class="block px-4 py-2 bg-blue-50 text-blue-700 rounded hover:bg-blue-100 transition text-sm font-semibold"
        >
          Gestionar Categorías
        </a>
      </div>
    </div>

    <div class="bg-white border border-primary-200 rounded-lg p-6">
      <h2 class="text-lg font-bold text-primary-800 mb-4">Información</h2>
      <p class="text-sm text-neutral-gray_dark mb-4">
        Desde este panel puedes gestionar todos los aspectos de tu tienda FashionMarket.
      </p>
      <p class="text-xs text-neutral-gray_light">
        Versión 1.0.0 • © 2026 FashionMarket
      </p>
    </div>
  </div>
</AdminLayout>
