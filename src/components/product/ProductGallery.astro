---
/**
 * ProductGallery.astro
 * Galería de imágenes del producto con soporte para múltiples imágenes
 */

interface Props {
  images?: string[];
  productName: string;
  alt?: string;
}

const { images = [], productName, alt = productName } = Astro.props;
const mainImage = images[0] || 'https://via.placeholder.com/600?text=Sin+imagen';
const thumbnails = images.slice(0, 4);
---

<div class="product-gallery">
  <!-- Imagen principal -->
  <div class="main-image-container mb-4 relative w-full bg-gray-100 rounded-lg overflow-hidden" style="aspect-ratio: 1 / 1">
    <img
      id="main-image"
      src={mainImage}
      alt={alt}
      class="w-full h-full object-cover transition-opacity duration-300"
      loading="lazy"
    />
  </div>

  <!-- Miniaturas -->
  {thumbnails.length > 1 && (
    <div class="thumbnails-container grid grid-cols-4 gap-2">
      {thumbnails.map((thumb, index) => (
        <button
          class={`thumbnail relative rounded overflow-hidden border-2 transition cursor-pointer ${
            index === 0 ? 'border-jd-red' : 'border-gray-200 hover:border-jd-red'
          }`}
          onclick={`
            document.getElementById('main-image').src = '${thumb}';
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('border-jd-red'));
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.add('border-gray-200'));
            event.target.closest('button').classList.add('border-jd-red');
            event.target.closest('button').classList.remove('border-gray-200');
          `}
          aria-label={`Ver imagen ${index + 1}`}
        >
          <img
            src={thumb}
            alt={`${productName} - Imagen ${index + 1}`}
            class="w-full h-full object-cover"
            loading="lazy"
          />
        </button>
      ))}
    </div>
  )}
</div>

<style>
  .product-gallery {
    position: relative;
  }

  .main-image-container {
    background: #f3f4f6;
  }

  .thumbnails-container {
    gap: 0.5rem;
  }

  .thumbnail {
    aspect-ratio: 1 / 1;
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
</style>
